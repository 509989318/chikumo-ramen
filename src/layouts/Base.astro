---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Preloader from '../components/Preloader.astro';
import type { Lang } from '../i18n/translations';

interface Props {
  title: string;
  description: string;
  lang: Lang;
  ogImage?: string;
  showPreloader?: boolean;
}

const { title, description, lang, ogImage = '/wp-content/uploads/2024/02/231222_0086-1-1.png', showPreloader = false } = Astro.props;
const langMap = { 'ja-jp': 'ja', 'zh-tw': 'zh-TW', 'en-us': 'en' };
const htmlLang = langMap[lang] || 'ja';
---

<!DOCTYPE html>
<html lang={htmlLang}>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <meta name="description" content={description}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={ogImage}>
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="icon" href="/wp-content/uploads/2023/11/Group-25.png">
  <link rel="stylesheet" href="/wp-content/uploads/elementor/google-fonts/css/jost.css">
  <link rel="stylesheet" href="/wp-content/uploads/elementor/google-fonts/css/notoserifjp.css">
  <link rel="stylesheet" href="/wp-content/uploads/elementor/google-fonts/css/roboto.css">
  <link rel="stylesheet" href="/wp-content/uploads/elementor/google-fonts/css/inter.css">
  <link rel="stylesheet" href="/wp-content/uploads/elementor/google-fonts/css/notosansjp.css">
  <link rel="stylesheet" href="/wp-content/uploads/elementor/google-fonts/css/notosanstc.css">
  <link rel="stylesheet" href="/wp-content/uploads/elementor/google-fonts/css/notoseriftc.css">
</head>
<body class="bg-white text-[#7A7A7A] font-['Roboto',sans-serif] overflow-x-hidden">
  {showPreloader && <Preloader />}
  <Header lang={lang} />
  <main>
    <slot />
  </main>
  <Footer lang={lang} />

  <script>
    // Preloader
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.querySelectorAll('.preloader').forEach(el => {
          el.classList.add('loaded');
          setTimeout(() => el.remove(), 600);
        });
      }, 800);
    });

    // Mobile menu
    const hamburger = document.getElementById('menu-hamburger');
    const mobileMenu = document.getElementById('mobile-menu');
    const overlay = document.getElementById('mobile-overlay');
    const closeBtn = document.getElementById('menu-close');

    function openMenu() {
      mobileMenu?.classList.add('active');
      overlay?.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function closeMenu() {
      mobileMenu?.classList.remove('active');
      overlay?.classList.remove('active');
      document.body.style.overflow = '';
    }

    hamburger?.addEventListener('click', openMenu);
    closeBtn?.addEventListener('click', closeMenu);
    overlay?.addEventListener('click', closeMenu);

    // Language dropdown
    const langToggle = document.getElementById('lang-toggle');
    const langDropdown = document.getElementById('lang-dropdown');
    langToggle?.addEventListener('click', (e) => {
      e.stopPropagation();
      langDropdown?.classList.toggle('hidden');
    });
    document.addEventListener('click', () => {
      langDropdown?.classList.add('hidden');
    });
  </script>
</body>
</html>
